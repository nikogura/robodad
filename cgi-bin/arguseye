#!/usr/bin/perl

use strict;
use feature qw(:5.10);

use CGI;
use HTML::Template;

my $tmplDir = "/project/robodad/templates";
my $soundDir = "/project/robodad/sounds";
my $q = CGI->new;
my $armMotionDetection = "/project/robodad/var/armed";

if ($q->param() && $q->param('sound')) {

	my $sound = $q->param('sound');

	system "mpg123 $soundDir/$sound.mp3";
	startScreen();

} elsif ($q->param() && $q->param('armed')) {

	if ($q->param('armed') eq 1) {

		system "touch $armMotionDetection";
	} else {
		unlink $armMotionDetection;
	}

	startScreen();

} else {
	startScreen();

}


#--------------------------------------------------
sub startScreen {
	print $q->header;

	my $tmplFile = "$tmplDir/home.tmpl";

	my $t = HTML::Template->new(
				filename 		=> $tmplFile,
				die_on_bad_params	=> 0,
			);

	my $tmplvars = {};

	$t->param($tmplvars);

	print $t->output;

}
